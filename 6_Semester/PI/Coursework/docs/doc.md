# PI_DB

## Условности запросов
* Ругаться, когда CREATE, UPDATE, INSERT, DROP, DELETE идут без оператора BEGIN
* SELECT, наоборот, не может быть в транзакции
* Транзакции не имеют имён. Должны начинаться с "BEGIN;", оканчиваться "COMMIT;"

## Шаги прогарммы
1. Запуск
1.1 Загрузка таблиц (хранилища) в кэш
1.2 Загрузка транзакционного лога в кэш
2. Получение команды
2.1 Парсинг всех строчек
2.2 Валидация строк (проверка существования таблиц, условности и т д)
2.3 Два разных сценария для SELECT и транзакций:
2.3.1 Для SELECT просто возвращается агрегированная табличка
2.3.2 Выполнение каждой из транзакций: весь запрос имеет главного исполнителя (MainExecutor), а так же каждая команда запроса имеет своего исполнителя (Creator, Dropper, etc...). Каждый исполнитель (главный и неглавный) создаёт копию хранилища, выполняет операции и возвращает копию. При успешной обработке MainExecutor записывает транзакции в транзакционный лог, а его копия сохраняется в кэш
2.4 Пользователю возвращается JSON типа:
{
    Status: "ok" | "error",
    Datatype: "table" | "msg"
    Data: csv table | string msg
}

## Представление транзакции в транзакционном логе
index,time,transaction_id,transaction_name,event_type,event_table,event_description

event_type - create | drop | update | insert
transaction_id - транзакция целиком объединяется в цепочку из нескольких

## План выполнения: 
1. Парсинг - Сделано
2. Вызов исполнителя - В процессе
3. Вызов главного исполнителя - В процессе
4. API - В процессе (Как только будет готова обработка, так будет доделано)
5. Клиент - В процессе (осталось лишь принимать запросы с сервера, остальное готово)
6. Аутентификация - Не начато (таблица pidb_users)